# Routers
### Words
- [[NAT]]
## Router components
1. [[Input ports]]
	- *port* in this context is the physical port and not to be confused with the software used ports
2. [[Switching Fabric]]
3. [[Output port]]
4. [[Routing processor]]

> This stuff is almost always hardware implimentation because it processes data too fast for software to control it

- COntrol plane stuff is usually software controlled and is much slower than actual routing (ms vs ns)
## Input port Processing and destination Based Forwading
- Example of possible routingtable:
- 
|prefix|Link interface|
|---|---|
|11001000 00010111 00010|0|
|11001000 00010111 00011000| 1|
|11001000 00010111 00011|2|
|Otherwise|3|

With this example the router would match the prefix of the packets destination and send it out that port if it doesnt match anything just send it to 3.
>[!Longests prefix matching rule]
>It is possible in the above example for an address to match port 2 and port 1 In this case the router will go with the longest prefix it can match

- It is possible that a packet is unable to enter the switching fabric due to traffic so queuing will happen at the input port
## Switching 

>The switching fabric is at the very heart of a router, as it is through this fabric that the packets are actually switched (that is, forwarded) from an input port to an output port. Switching can be accomplished in a number of ways.

- **Switching Via Memory**
	- Sounds like this was implimented inthe 'timplest earliest routers' and workedl ike an OS. The packet would arrive and signal the processor and then the packet would be copied into the router memory and then copied into the output port buffer
	- If the memory bandwith max is B/s then the forwarding throughput $<B/2$
- **Switching Via bus**
	- Input port transfers packet directly to the output port over a shared bus
	- Input port pre-pends a [[switch-internal label]] to the packet indidcating the output port to recieve it
	- All output ports have access to the packet but only designated one transmits it
	- only 1 packet allowed on the bus at a time
	- This speed is usualy sufficient for small networks
- **Switching via an interconnection network**
	- Crossbar switch is an interconnection network consisting of:
		- *2N* busses
		- Connecting *N* input ports to *N* output ports
	- ![[Pasted image 20220525235247.png]]
	- Each intersection can be opened or closed by the switch fabric controller
## Output Port Processing

>[! Overly Complicated Numbers]
>$R_{line}=$ Rate at which packets are being input and output
>$R_{switch}=$ Rate at which packets transfer from input to output ports
>$N$=number of input and output ports
>if $R_{switch}$ is N times greater than $R_{line}$ then only negligible queuing will occur
>

- **Input Queuing**
	- If the switch fabric is slower than the packet arrival speed then queuing will occur at the input ports
	- *Head of the line blocking* packets that dont need to be blocked (it's destination port is open) are blocked  because the packet infront of them is blocked 
- **Output Queuing**
	- If packets are arriving at $R_{line}$ rate on all input ports and are all destined for the same output port then output queuing will occur since the output port can only transmit one packet at time
	- Packets will be dropped if output memory is exhausted. Which packts are dropped is not a standard and may differ between systems

### Packet Schdeuling
- **FIFO**: also known as first-come-first-served
- **Priority QUeueing**: An example might be a network operator configuring a queue so that packets carrying network management information recieve priority
	- The priority class would have it's own queue and the link would pull from that and low prior queue
- **Round Robin**: Packets split into classes and each class gets a turn if it cant find a packed of some class type it will keep going in a work conserving rr
	- [[WFQ]] idk wtf 

![[Pasted image 20220526231355.png]]