# IPv4 IPv6 IP-PP
### IPv4
40 bytes of overhead (20 TCP 20 IP)
![[Pasted image 20220526235059.png]]
- **Version number** 4 bits specify protocol version
- **HeaderLength** 4 bits used to determine where in the datagram the payload starts. Maybe says if there are "options"
- **Type of service** I guess this says if its FTP or http or whatever
- **datagram length** Total length of IP datagram field is 16 bits long 
- **Identifier, flags, frag offset** have to do with IP fragmentation (no details provided) frag flag is 1 for if its a fragment and 0 at the last fragment
- **Time to live** (TTL) ensure that datagrams do not circulate forever in the network its a number that gets decremented each time the datagram is processed. If it reaches 0 it gets dropped
- **Protocol** used when IP datagram reaches final destination. indicates the transport layer or protocol to which the data portion of this datagram should be passed. EG: value 6 indicates TCP and 17 indicates UDP
- **Header Checksum** Aids router in detecting bit errors in IP datagramsuses 1s compliment. TYpically discard bad ones
- **Source and desitination IP** self explanitory. Destination usually comes from dns
- **Options** variable length... not much info provided in text
- **DATA** whatever were sending
### IPv4 Datagram Fragmentation
Maximum amound of data that a link-layer frame can carry is called the [[MTU]]. There is a p roblem that ther are multiple protocols on the internet with varying size MTUs. Inorder to address this, if a router is forwarding a packet to a router with a smaller MTU it splits it up int *fragrments* which are reassembled before they reach the transport layer. The recieving host can tell it's a framgent by the Identier flag offset. The last one has a zero
### IPv4 Addressing
- 32 bits long (4 bytes) $2^{32}$ (~4b) possible IP address 
- Written in *dotted-decimal notation* 
- **Subnet mask** example */24* meanns the left most 24 of the 32 bits
	- **Classless Interdomain Routing (CIDR) pronounced cider)**
	- Maybe callled Network prefix
	- When datagrams from outside the subnet are being forwarded to the subnet only the prefix is considered
- a $/24$ subnet can be applied by a binary AND operation with the ip address to get the subnet number
- 256 numbers per byte but the top address is broadcast and the first number defines the network
- **Classful addressing** before CIDR subnets were constrainged to {8,16,24} bitst known as class {A,B,C}
	- This became problematic because the resolution was really bad /24 supports 254 hosts and /16 goes all the way up to 65,634
- **IP broadcast address**  When a host sends a datagram with destination address 255.255.255.255, the message is delivered to all hosts on the same subnet. Routers optionally forward the message into neighboring subnets as well
>[!The INTERWEB! Where do ISPs  get their IP addys?]
>IP addresses are managed under the authority of the Internet Corporation for Assigned Names and Numbers (ICANN). FF: THey also manage DNS root servers
- It says that system administrator typically manually configures IP addresses into a router Crayjy 
- **Dyanmic Host COnfiguration Protocal** Host addresses usually confiures by DHCP 

### DHCP
1. **DHCP Server Discover** Client sends discover message witht UDP To port 67 and sends it to the broadcast destination `255.255.255.255` with a "this host" source IP of `0.0.0.0` The linklayer will broadcast this to all nodes on the subnet 
2. **DHCP Server Offer** Server will respond to the client with a DHCP offer message that is broadcast to all nodes on the subnet with same broadcast IP. There may be multiple dhcp servers avbailbile on t he subnet. This includes proposed IP address and leasetime 
3. **DHCP Request** Client chooses one or more of the offers and responds to it's selected offer with DHCP request message echoing back the config
4. **DHCP ACK** server basically says ok
### Network Address Translation (NAT)
This service is used to address the scenario in which a small home network or office network is to add mutliple devices and the ISP providing IPs for each device is not feasible. 
- **Realm with private addresses** eg *10.0.0.0/8* is an address space reserved for *Private ntwork* is a network whos addresses only have meaning to devices withing that network
- **NAT** enable routers do not look like a router to the outside world. They behave like a single device with a single IP 
- These routers often get their IP addresses from the ISP's DHCP serv3er
- **NAT Translation table** which exists in the router and includes portnumbers as well as IP addresses of connected devices
- When you send some request from your IP and the port to the NAT router it replaces the source IP with it's ip and then sends it out with one of its port numbers Which it then maps in its table IE: *Port 5001 -> 10.0.0.1:3959* 
- NAT violates the idea that hosts should be talking directly to one another because it re-writes the port numbers
### IPv6 Like whhyyyy
- Successor to the IPv$ protocol 
- effort began in the early 90s
![[Pasted image 20220528222635.png]]
1. **Version** same ad v4 says hello im v6
2. **Traffic class** 8-bit traffic class field like TOS field in IPv4 can give priority to datagrams for certain things (like SMTP email?) 
3. **Flow Label** 20-bit field to identify flow datagrams?
4. **payload length** 16 bit value gives number of bytes in the datagram following fixed length 40byte datagram header
5. **NExt header** identifies the protcol like tcp  or udp
6. **Hop Limit** decremented by each router when it reaches 0 it is discarded... like TTL?
7. **Source and destination**
8. **Data**
==fields in ipv4 not in ipv6==
- Fragmentation IPV6 does not allow fragmentation and reassemhbly at intermediate routers. If a packet is too big a router will drop it and send a "Packet too big" ICMP error back
- Header checksum relies on the transport layer also with the hop nuber changing this has to be recalculated at each hop
- oPtions. nobody uised this anyway